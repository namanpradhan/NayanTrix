rule Suspicious_PE_Header
{
    meta:
        description = "Detects suspicious Windows PE headers based on MZ signature"
        author = "NayanTrix"
        category = "pe"
        tags = "header pe mz"
    strings:
        $mz = { 4D 5A }  // MZ signature in hexadecimal
    condition:
        uint16(0) == 0x5A4D and $mz at 0
}

rule Malware_Generic_Strings
{
    meta:
        description = "Detects common keywords used by keyloggers, stealers, and malware"
        author = "NayanTrix"
        category = "generic"
        tags = "keylogger stealer malware"
    strings:
        $s1 = "keylogger" nocase ascii
        $s2 = "passwords.txt" nocase ascii
        $s3 = "stealer" nocase ascii
        $s4 = "clipboard" nocase ascii
    condition:
        any of ($s*)
}

rule Packed_Executable_UPX
{
    meta:
        description = "Detects executables packed with UPX packer"
        author = "NayanTrix"
        category = "packer"
        tags = "upx packer"
    strings:
        $upx1 = "UPX0" ascii
        $upx2 = "UPX1" ascii
        $upx3 = "UPX2" ascii
    condition:
        any of ($upx*)
}

rule RAT_Backdoor_Indicators
{
    meta:
        description = "Detects common strings used in RATs or backdoor payloads"
        author = "NayanTrix"
        category = "rat"
        tags = "rat backdoor"
    strings:
        $r1 = "socket" nocase ascii
        $r2 = "connect" nocase ascii
        $r3 = "cmd.exe" nocase ascii
        $r4 = "powershell" nocase ascii
        $r5 = "shellcode" nocase ascii
    condition:
        3 of ($r*)
}

rule Inline_Shellcode_Detection
{
    meta:
        description = "Detects inline x86 shellcode patterns commonly used in memory injection"
        author = "NayanTrix"
        category = "shellcode"
        tags = "shellcode injection"
    strings:
        $hex1 = { FC 48 83 E4 F0 E8 C0 00 00 00 41 51 41 50 52 51 56 }
        $hex2 = { 31 C0 50 68 2E 65 78 65 68 63 61 6C 63 8B C4 }
    condition:
        any of ($hex*)
}

rule Suspicious_API_Calls
{
    meta:
        description = "Detects use of suspicious Windows API calls for injection or evasion"
        author = "NayanTrix"
        category = "behavior"
        tags = "api injection behavior"
    strings:
        $a1 = "VirtualAlloc" ascii nocase
        $a2 = "WriteProcessMemory" ascii nocase
        $a3 = "CreateRemoteThread" ascii nocase
        $a4 = "NtQueryInformationProcess" ascii nocase
    condition:
        2 of ($a*)
}
